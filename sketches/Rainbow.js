const td = new Canv('canvas', {
    fullscreen: true,
    setup() {

        this.path = [[0,375],[7,369],[7,369],[7,369],[9,369],[10,369],[11,369],[13,369],[15,371],[18,371],[21,371],[25,371],[27,371],[29,371],[29,371],[30,371],[31,371],[32,371],[34,371],[37,371],[41,371],[44,371],[47,371],[49,371],[58,371],[61,371],[63,370],[63,370],[63,370],[64,370],[66,371],[70,373],[72,374],[72,374],[77,374],[87,374],[90,374],[95,374],[100,374],[105,374],[106,374],[106,374],[111,378],[115,379],[120,379],[129,379],[132,379],[138,378],[150,375],[153,374],[156,372],[166,369],[169,366],[176,372],[179,373],[186,372],[189,371],[191,369],[194,361],[200,348],[203,337],[206,329],[206,321],[201,316],[194,308],[192,304],[192,304],[188,298],[188,295],[188,295],[188,294],[188,294],[188,294],[189,293],[190,291],[193,286],[193,284],[195,280],[196,273],[197,267],[197,264],[195,257],[194,248],[194,243],[192,235],[192,232],[190,225],[189,219],[188,216],[188,216],[188,215],[188,213],[188,213],[188,213],[188,211],[189,209],[190,207],[192,204],[192,204],[194,202],[196,198],[200,194],[201,193],[203,192],[206,191],[208,190],[214,187],[219,182],[225,179],[225,179],[225,178],[229,175],[239,170],[241,169],[242,168],[248,168],[252,168],[258,168],[264,168],[265,168],[271,165],[282,165],[283,164],[290,161],[290,161],[293,159],[295,158],[302,158],[310,158],[315,158],[329,158],[334,158],[341,158],[342,158],[342,158],[352,158],[353,158],[354,158],[355,160],[358,162],[367,165],[372,166],[376,166],[380,168],[381,168],[382,169],[383,169],[385,170],[390,175],[394,178],[396,180],[399,182],[401,182],[402,183],[404,184],[407,186],[413,189],[415,191],[416,192],[420,197],[424,201],[429,208],[431,216],[431,221],[432,228],[432,236],[432,241],[432,243],[432,244],[431,248],[430,253],[428,253],[428,253],[428,253],[427,261],[427,269],[427,269],[427,271],[427,277],[427,278],[427,278],[427,281],[427,283],[427,287],[427,289],[427,289],[427,289],[427,289],[428,293],[428,299],[429,299],[430,303],[433,306],[433,306],[434,307],[435,312],[435,314],[435,316],[435,320],[435,323],[435,326],[435,330],[435,340],[435,348],[435,349],[433,350],[433,350],[431,357],[427,367],[427,374],[427,377],[427,387],[427,391],[427,391],[427,395],[427,401],[427,405],[429,412],[429,412],[430,416],[430,419],[430,420],[431,424],[431,424],[432,426],[432,429],[432,430],[432,433],[432,436],[432,437],[432,440],[432,447],[432,453],[432,459],[432,461],[432,466],[432,468],[432,469],[432,473],[432,481],[432,481],[432,481],[433,485],[435,486],[437,493],[437,498],[438,505],[438,508],[438,509],[438,512],[438,519],[438,519],[438,525],[438,535],[438,541],[438,545],[439,550],[440,551],[440,552],[440,554],[440,554],[439,555],[438,555],[437,555],[436,555],[436,555],[434,557],[431,559],[428,563],[428,563],[428,564],[426,565],[426,565],[422,566],[419,566],[416,566],[412,566],[406,566],[402,566],[400,566],[396,566],[394,566],[391,566],[391,566],[389,566],[385,566],[380,569],[374,570],[371,571],[367,572],[364,572],[361,572],[355,574],[345,575],[337,575],[332,575],[331,575],[326,575],[324,575],[318,573],[310,571],[306,567],[305,567],[305,567],[305,567],[301,567],[297,567],[295,567],[294,567],[293,567],[293,567],[290,567],[290,567],[287,567],[283,567],[281,567],[277,567],[266,570],[255,571],[253,572],[253,572],[252,572],[251,572],[251,572],[247,571],[242,571],[237,571],[230,571],[220,571],[209,571],[205,571],[202,571],[197,571],[192,571],[187,571],[174,571],[169,571],[166,572],[166,572],[164,572],[164,572],[159,573],[157,573],[157,573],[155,573],[154,573],[153,573],[153,573],[152,574],[150,574],[147,574],[143,577],[138,579],[134,581],[131,582],[129,583],[125,587],[124,588],[123,590],[120,595],[118,601],[117,604],[116,606],[113,612],[113,612],[113,614],[113,620],[113,620],[113,620],[113,621],[111,626],[111,626],[111,626],[111,635],[110,643],[110,643],[110,645],[110,653],[110,654],[110,657],[112,666],[112,666],[112,666],[113,669],[113,675],[113,677],[115,680],[115,680],[117,684],[120,691],[121,692],[122,695],[124,698],[128,702],[129,704],[131,705],[137,708],[144,708],[146,708],[148,708],[152,708],[164,711],[165,711],[171,711],[172,711],[174,711],[178,707],[181,705],[187,702],[189,702],[192,702],[194,702],[198,702],[200,702],[203,702],[205,702],[210,704],[214,706],[219,710],[220,711],[220,711],[221,711],[221,711],[222,712],[228,713],[236,713],[236,713],[236,713],[236,713],[242,712],[242,712],[242,712],[242,712],[242,712],[242,712],[242,712],[242,712],[242,712],[242,712],[242,712],[242,712],[242,712],[243,712],[244,712],[246,712],[248,713],[250,713],[250,713],[250,713],[251,713],[251,713],[253,713],[253,713],[254,713],[256,713],[259,713],[259,713],[262,713],[268,713],[277,712],[283,712],[287,712],[288,712],[292,712],[293,712],[294,712],[297,710],[299,708],[302,707],[304,707],[307,707],[319,706],[319,706],[319,706],[319,706],[319,706],[321,706],[321,706],[321,706],[321,706],[321,706],[325,706],[325,706],[326,706],[327,705],[328,703],[328,703],[328,703],[328,703],[330,703],[335,702],[341,702],[343,702],[345,702],[345,702],[345,702],[349,703],[353,704],[353,704],[358,704],[389,712],[390,712],[390,712],[390,712],[390,712],[390,712],[391,712],[395,711],[395,711],[397,709],[397,709],[398,709],[401,708],[402,708],[406,707],[408,707],[410,706],[413,705],[419,703],[429,703],[444,703],[444,703],[444,703],[444,703],[444,703],[446,703],[453,703],[458,703],[458,703],[461,703],[464,703],[474,703],[477,703],[479,704],[479,704],[480,705],[481,706],[485,707],[486,707],[489,707],[491,707],[496,707],[496,707],[496,707],[496,707],[497,707],[500,705],[512,704],[513,704],[519,703],[530,703],[532,703],[534,703],[543,703],[548,703],[560,703],[565,705],[565,705],[570,705],[579,703],[586,702],[593,702],[596,702],[597,702],[604,702],[611,702],[620,702],[630,702],[630,702],[630,702],[630,702],[630,702],[635,702],[637,702],[638,702],[641,702],[645,702],[647,702],[649,702],[657,702],[659,703],[661,704],[662,705],[663,705],[665,706],[676,707],[678,707],[686,709],[693,710],[702,712],[707,712],[713,712],[721,712],[733,711],[739,710],[743,708],[744,708],[746,707],[747,707],[749,707],[752,704],[760,704],[771,704],[789,704],[789,704],[790,704],[794,704],[801,704],[804,704],[808,704],[817,704],[820,704],[826,705],[828,705],[833,704],[834,704],[837,702],[841,702],[847,702],[848,702],[850,701],[850,701],[852,699],[855,696],[857,696],[857,696],[862,693],[864,692],[866,690],[869,688],[872,685],[874,682],[876,679],[877,678],[878,675],[880,671],[880,669],[880,663],[881,655],[882,654],[882,652],[882,650],[883,646],[885,639],[886,633],[886,629],[886,621],[886,618],[886,615],[885,606],[884,602],[884,596],[882,588],[881,584],[881,584],[880,578],[878,567],[877,563],[874,553],[869,541],[867,533],[867,533],[866,531],[866,531],[865,524],[864,522],[864,520],[864,519],[864,517],[864,515],[863,513],[863,512],[863,511],[862,509],[861,505],[857,499],[854,496],[854,496],[854,496],[843,495],[838,494],[838,494],[831,491],[823,490],[822,490],[821,490],[821,490],[816,490],[811,492],[807,492],[798,494],[789,495],[783,498],[773,498],[769,498],[763,498],[749,498],[737,498],[729,496],[726,496],[725,495],[723,494],[721,492],[717,491],[710,490],[709,490],[704,490],[699,490],[695,490],[694,490],[693,490],[691,490],[688,490],[681,490],[675,490],[671,490],[669,489],[665,489],[662,489],[656,489],[651,488],[647,487],[642,482],[638,479],[637,475],[635,469],[634,462],[634,459],[634,457],[634,454],[634,452],[633,447],[633,445],[632,443],[631,441],[631,440],[631,440],[631,439],[629,435],[628,433],[626,427],[626,425],[625,424],[624,420],[624,417],[624,412],[624,408],[624,402],[624,399],[624,394],[625,389],[625,386],[626,383],[626,379],[627,377],[627,375],[628,368],[628,368],[628,363],[628,354],[628,353],[628,347],[628,343],[628,335],[628,333],[628,331],[628,331],[628,331],[628,328],[630,326],[632,322],[632,321],[632,321],[634,320],[635,319],[636,319],[639,316],[642,314],[644,313],[646,312],[651,310],[653,309],[658,309],[661,309],[662,309],[667,309],[670,309],[674,309],[676,309],[679,309],[681,309],[687,307],[694,306],[696,306],[697,306],[699,306],[700,306],[702,306],[705,306],[708,306],[710,306],[715,306],[721,306],[728,306],[728,306],[729,306],[729,306],[730,306],[730,306],[736,306],[741,306],[746,306],[751,306],[760,306],[763,306],[766,306],[771,308],[773,310],[773,310],[773,310],[774,310],[781,310],[785,310],[789,310],[789,310],[795,310],[800,306],[801,306],[805,304],[809,304],[821,302],[823,302],[823,302],[823,302],[825,302],[829,302],[829,302],[832,302],[835,302],[840,303],[844,306],[844,306],[846,306],[849,306],[855,308],[859,309],[864,309],[870,309],[871,309],[871,309],[871,309],[871,309],[873,308],[875,306],[877,304],[878,302],[879,300],[880,296],[882,295],[883,292],[884,288],[884,283],[884,283],[884,283],[884,283],[884,283],[884,283],[884,283],[884,283],[884,283],[884,283],[884,283],[884,283],[885,281],[888,273],[888,272],[888,272],[888,270],[888,269],[888,267],[888,263],[889,257],[891,252],[891,251],[892,247],[895,243],[896,240],[899,236],[900,233],[900,233],[900,233],[900,230],[899,229],[898,228],[897,226],[895,220],[894,211],[893,207],[892,203],[889,195],[886,190],[883,185],[879,182],[879,182],[878,180],[876,177],[873,164],[873,156],[873,155],[873,154],[873,148],[873,143],[873,141],[873,134],[874,128],[874,122],[875,115],[875,112],[875,112],[875,112],[875,112],[873,108],[869,105],[865,103],[855,98],[844,96],[840,94],[838,94],[832,93],[830,93],[827,92],[827,91],[823,89],[818,87],[813,85],[807,84],[798,80],[795,78],[793,78],[788,78],[784,78],[783,78],[781,79],[781,79],[777,82],[775,83],[772,85],[770,85],[767,86],[767,86],[765,88],[758,88],[755,88],[755,88],[751,89],[750,90],[750,90],[748,90],[745,90],[745,89],[743,88],[741,87],[740,87],[738,87],[737,87],[737,87],[735,87],[734,87],[728,89],[726,90],[726,90],[722,93],[720,94],[716,96],[716,96],[714,96],[710,96],[706,96],[701,96],[692,96],[688,96],[681,96],[678,96],[673,96],[669,96],[661,96],[656,96],[648,96],[642,96],[638,97],[636,98],[636,98],[632,99],[622,101],[607,101],[602,104],[599,104],[595,104],[591,105],[586,105],[586,105],[582,105],[578,105],[576,105],[572,105],[570,105],[566,104],[563,101],[559,98],[556,95],[553,91],[550,89],[549,87],[549,81],[549,71],[549,69],[549,67],[549,66],[549,65],[549,59],[549,58],[549,58],[550,57],[550,54],[550,52],[550,50],[549,46],[549,45],[548,42],[548,40],[548,37],[548,37],[548,37],[548,37],[548,37],[548,37],[547,33],[547,30],[547,30],[545,28],[545,27],[545,27],[545,26],[545,21],[543,14],[542,9],[542,9],[542,5],[541,3],[541,3],[541,3],[541,3],[541,2],[541,2],[541,1],[541,1],[541,1],[541,1],[541,1]]
        this.clicked = false;

        this.bg = new Pic(
            "images/BTDMap.webp",
            0, 0,
            this.width, this.height
        );

        this.updateDelay = 4;

        this.balloons = [];
    },

    drawPath(path) {
        for(let i = 0; i < path.length; i++) {
            if(i < path.length-1) {
                let line = new Line(
                    path[i][0], path[i][1],
                    path[i+1][0], path[i+1][1]);
                this.add(line);
            }
        }
    },

    addBalloon() {
        this.balloons.push(0);
    },

    update() {
        if(this.frames % 50 === 0) {
            this.addBalloon();
        }

        for(let i = this.balloons.length-1; i >= 0; i--) {
            if(this.balloons[i] === this.path.length-1) {
                this.balloons.splice(i, 1);
            } else {
                this.balloons[i]++;
            }
        }

        this.enableCustomPath();
    },


    enableCustomPath() {
        if(this.mouseDown && !this.clicked) {
            this.clicked = true;

            this.path.push([this.mouseX, this.mouseY]);

            setTimeout(() => {
                this.clicked = false;
            }, 10);
        }
    },

    draw() {
        this.clear();
        this.add(this.bg);
        
        // this.drawPath(this.path);
        for(let i = 0; i < this.balloons.length; i++) {
            let x = this.path[this.balloons[i]][0];
            let y = this.path[this.balloons[i]][1];
            this.add(
                new ShapeGroup([
                    new Circle(
                        x, y,
                        30
                    )
                    .setColor(new Color(200,0,0)),
                    new Text(x+","+y, x, y)
                    .setAlign("center")
                    .setSize(10)
                ])
            )
        }
    }
})